# Mockc: Complie-time mock generator for Go
Mockc is a compile-time mock generator for Go. It simply parses your mock generators and creates mocks. Mockc is completely type safe. You can use it just by writing a mock generator with `mockc.Implements` and `mockc.SetMode`.

> This is beta release. This might have some bugs. Please submit your [issue](https://github.com/KimMachineGun/mockc/issues/new).

## Features
- [x] Mock creation
- [ ] Mock mode settings

## Installation
```
go get github.com/KimMachineGun/mockc/cmd/mockc
```

## Look and Feel
### 1. Create mock generator
#### interface example:
```go
package ex

type Cache interface {
	Get(key string) (val interface{}, err error)
	Set(key string, val interface{}) (err error)
	Del(key string) (err error)
}
```
#### mock generator example:
```go
//+build mockc

package ex

import (
	"github.com/KimMachineGun/mockc"
)

func MockcCache() {
	mockc.Implements(Cache(nil))
}
```
### 2. Generate mocks
#### command example:
```sh
mockc [<packages-pattern>]
```
#### generated file example:
```go
// Code generated by Mockc. DO NOT EDIT.
// repo: https://github.com/KimMachineGun/mockc

//go:generate mockc
//+build !mockc

package ex

type MockcCache struct {
	mockcs struct {
		// method: Set
		Set struct {
			// basics
			Called    bool
			CallCount int
			// last params
			Params struct {
				key string
				val interface{}
			}
			// last results
			Results struct {
				err error
			}
			// if Body is not nil, it is called in the middle of the method.
			Body func(string, interface{}) error
		}
		// method: Del
		Del struct {
			// basics
			Called    bool
			CallCount int
			// last params
			Params struct {
				key string
			}
			// last results
			Results struct {
				err error
			}
			// if Body is not nil, it is called in the middle of the method.
			Body func(string) error
		}
		// method: Get
		Get struct {
			// basics
			Called    bool
			CallCount int
			// last params
			Params struct {
				key string
			}
			// last results
			Results struct {
				val interface{}
				err error
			}
			// if Body is not nil, it is called in the middle of the method.
			Body func(string) (interface{}, error)
		}
	}
}

func (recv *MockcCache) Set(key string, val interface{}) error {
	// basics
	recv.mockcs.Set.Called = true
	recv.mockcs.Set.CallCount++
	// params
	recv.mockcs.Set.Params.key = key
	recv.mockcs.Set.Params.val = val
	// body
	if recv.mockcs.Set.Body != nil {
		recv.mockcs.Set.Results.err = recv.mockcs.Set.Body(key, val)
	}
	// results
	return recv.mockcs.Set.Results.err
}

func (recv *MockcCache) Del(key string) error {
	// basics
	recv.mockcs.Del.Called = true
	recv.mockcs.Del.CallCount++
	// params
	recv.mockcs.Del.Params.key = key
	// body
	if recv.mockcs.Del.Body != nil {
		recv.mockcs.Del.Results.err = recv.mockcs.Del.Body(key)
	}
	// results
	return recv.mockcs.Del.Results.err
}

func (recv *MockcCache) Get(key string) (interface{}, error) {
	// basics
	recv.mockcs.Get.Called = true
	recv.mockcs.Get.CallCount++
	// params
	recv.mockcs.Get.Params.key = key
	// body
	if recv.mockcs.Get.Body != nil {
		recv.mockcs.Get.Results.val, recv.mockcs.Get.Results.err = recv.mockcs.Get.Body(key)
	}
	// results
	return recv.mockcs.Get.Results.val, recv.mockcs.Get.Results.err
}
```
### 4. Feel free to use the generated mock
Please add `//+build !mockc` build tag to the file using the generated mocks.
```go
//+build !mockc

package ex

import (
	"testing"
)

func HasKey(c Cache, key string) (bool, error) {
	val, err := c.Get(key)
	if err != nil {
		return false, err
	}

	return val != nil, nil
}

func TestHasKey(t *testing.T) {
	key := "key str"

	m := &MockcCache{}
	m.mockcs.Get.Results.val = true

	expected := true
	actual, err := HasKey(m, key)

	if expected != actual {
		t.Errorf("HasKey results: expected(%v) != actual(%v)", expected, actual)
	}
	if err != nil {
		t.Errorf("err is not nil: %v", err)
	}

	if m.mockcs.Get.CallCount != 1 {
		t.Errorf("Cache.Get call count is not 1: %v", m.mockcs.Get.CallCount)
	}
	if m.mockcs.Get.Params.key != key {
		t.Errorf("Cache.Get.Params: expected(%v) != actual(%v)", key, m.mockcs.Get.Params.key)
	}
}
```

## Inspired by üôè
- [github.com/google/wire](https://github.com/google/wire)
- [github.com/sasha-s/goimpl](https://github.com/sasha-s/goimpl)
- [github.com/vektra/mockery](https://github.com/vektra/mockery)
